# Typecho 访客统计插件-VisitorLogger-Pro
这是一个为 Typecho 博客系统开发的访客统计插件，基于原版的VistorLogger修改版本。该插件提供了详细的访问统计功能，包括访问国家/地区统计、IP分布等信息，并进行了隐私保护处理。

## 功能特点

### 数据统计功能
- 访问国家/地区统计（Top 30）
- IP分布统计（已匿名化处理）
- 省份访问统计图表
- 路由访问统计分析（页面访问量统计）
- 访问时间统计（按日期分布）
- 管理员访问自动排除

### 数据筛选功能
- 日期范围选择器
- 快捷时间选择（今天、最近7天、最近30天、全部）
- 按钮选中状态高亮显示
- 默认只加载近7天数据，优化首次加载速度

### 数据展示功能
- ECharts环形图表展示方式
- 列表视图支持（详细数据展示）
- 图表悬停效果（显示详细信息）
- 自适应图表区域

### 数据管理功能
- 删除特定IP记录功能（支持模糊匹配）
- 数据库自动优化
- 时区自动转换功能，确保访客时间记录准确

### 性能优化
- 异步API数据加载（getVisitStatistic.php）
- **解决大数据量加载问题，提高页面响应速度（从10s优化到2s）**
- 使用CDN加载ECharts图表库，减少插件体积
- 优化移动端显示

### 隐私保护
- IP地址匿名化处理（只显示前两段）
- 明确的隐私声明
- 符合相关法律法规要求
- 数据安全存储

### 界面特性
- 移动端自适应布局
- 美观的图表展示
- 增高环形图展示区域，改善视觉效果
- 列表/图表切换视图
- 优雅的加载动画

## 页面预览
![image](https://github.com/user-attachments/assets/873b080e-6e6b-4187-b58c-046168b83dcb)
![image](https://github.com/user-attachments/assets/42d8bee6-56f3-4eca-9a3b-e4635d2faf62)
![image](https://github.com/user-attachments/assets/f4c28629-39f9-4487-9cd4-4a0de2e48e0e)
![image](https://github.com/user-attachments/assets/1707d2b4-6cb5-4d48-8d9a-27634ef6fb3f)



## 安装方法

1. 下载插件文件
2. 在本地解压后把目录名改为VisitorLoggerPro
3. 将改后的文件上传到/usr/plugins目录下
4. 插件名为VisitorLoggerPro
5. 在 Typecho 后台启用插件
6. 要把该文件`visitor-stats.php`移动到handsome主题根目录（handsome主题适用）

## 使用说明

### 基本使用（Handsome主题适用）

1. 在 Typecho 后台创建新页面
2. 在页面模板中选择"访客统计"
3. 发布页面即可看到统计效果
4. 创建新页面，选择"访客统计"模板

## 问题说明

插件启用失败解决办法：
有一部分小伙伴之前使用过VisitorLogger插件，然后如果直接启用VisitorLoggerPro的话会报错
- 1.只需要把VisitorLogger相关文件全部删除即可，也就是两者不能共存。
- 2.数据库表不需要修改，但也可以把bot_list表删掉因为用不到。

## 隐私保护

本插件已实现以下隐私保护措施：
- IP地址匿名化处理（只显示前两段）
- 明确的隐私声明
- 符合相关法律法规要求

## 技术实现

- 前端：ECharts 图表库
- 后端：PHP + MySQL
- 数据存储：Typecho 数据库
- 数据处理：通过API异步加载，提高性能

## 作者信息

- 作者：BXCQ
- 博客：https://blog.ybyq.wang/
- GitHub：https://github.com/BXCQ

## 许可证

MIT License

## 更新日志

## v2.1.1 (2024-06-21)

### 优化
- 移除本地chart.js文件（约200KB），减少插件体积
- 全部使用CDN加载ECharts图表库

### 修复
- 删除panel.php中对本地chart.js的引用

## v2.1.0 (2024-06-18)

### 前台优化
- 新增API端点(getVisitStatistic.php)处理数据聚合
- **解决大数据量加载问题，提高页面响应速度（从10s优化到2s）**
- 添加日期范围选择器和快捷按钮（今天、最近7天、最近30天、全部）
- 实现按钮选中状态高亮显示
- 优化首次加载速度，默认只加载近7天数据
- 增高环形图展示区域，改善视觉效果
- 修复图表悬停效果

### 后台优化
- 添加删除特定IP记录功能（支持模糊匹配）
- **重构图表加载逻辑，使用异步API获取数据**
- 添加省份访问统计图表
- 优化后台路由统计，解决X轴信息重叠问题
- 优化日期选择功能

### 修复
- 修复内容解码错误(ERR_CONTENT_DECODING_FAILED)
- 修复SQL错误(Unknown column 'province')

## v2.0.2 (2024-06-13)

### 功能增强
- **新增后台忽略IP名单功能**，支持批量添加和删除
- **前台删除管理员（自己）访问记录功能**，保持统计数据纯净
- 优化CDN环境下IP识别机制，解决IP不准确问题
- 添加IP地址过滤器，支持自定义过滤规则

### 修复
- **修复PHP 8.0环境下的弃用函数警告**
- 修复在某些主题下的样式冲突问题
- 修复日期选择器在移动端的显示问题
- 优化数据库查询，减少资源占用

## v2.0.1 (2024-05-15)

### 功能改进
- 修复时区问题：将数据库time字段从TIMESTAMP改为DATETIME类型
- **添加服务器时区自动转换功能**，确保访客时间记录准确
- 优化数据迁移处理，自动转换已有记录的时区
- **添加适配器（adapter.php），实现原版插件与当前插件的无缝衔接**

## v2.0.0 (2024-04-23)

### 主要功能
- 初始版本发布
- 实现基本访客统计功能
- 国家/地区访问统计
- IP分布统计（已匿名化处理）
- ECharts环形图表展示方式
- 列表视图支持
- 移动端适配

### 隐私保护
- IP地址匿名化处理（只显示前两段）
- 明确的隐私声明
- 符合相关法律法规要求

### 其他
- 优化移动端显示
- 管理员访问自动排除
